<div ng-controller="VisEditor" class="vis-editor vis-type-{{ vis.type.name }}">
  <md-toolbar ng-show="chrome.getVisible()" class="md-whiteframe-z1 md-hue-2">
      <div class="md-toolbar-tools">
          <div class="tg-filter-toolbar-field bitty-modal-container" flex>
            <div ng-if="vis.type.requiresSearch && $state.linked && !unlinking"
              ng-dblclick="unlink()"
              tooltip="Double click to unlink this visualization from the saved search"
              class="bitty-modal visualize-linked"
              layout="row" layout-align="center center">
              <i aria-hidden="true" class="mdi mdi-link"></i>
              &nbsp;
              This visualization is linked to a saved search:
              <b>{{ savedVis.savedSearch.title }}</b>
            </div>

            <div
              ng-if="vis.type.requiresSearch && unlinking"
              ng-click="clearUnlinking()"
              class="bitty-modal" layout="row" layout-align="center center">
              <i aria-hidden="true" class="mdi mdi-link-off"></i> Unlinked!
            </div>

            <form ng-if="vis.type.requiresSearch && $state.linked"
                  name="queryInput" layout="row" flex>
              <md-icon md-font-set="mdi" md-font-icon="mdi-magnify" class="mdi-24px">
              </md-icon>
              <div class="typeahead" flex>
                  <input
                    disabled
                    type="text">
              </div>
            </form>

            <div class="typeahead" kbn-typeahead="visualize" flex>
              <form ng-if="vis.type.requiresSearch && !$state.linked"
                    ng-submit="fetch()" name="queryInput" layout="row" flex>
                <md-icon md-font-set="mdi" md-font-icon="mdi-magnify" class="mdi-24px">
                </md-icon>
                  <div ng-class="queryInput.$invalid ? 'has-error' : ''" flex>
                    <input
                      ng-model="state.query"
                      parse-query
                      input-focus
                      kbn-typeahead-input
                      placeholder="Search..."
                      aria-label="Search"
                      type="text">
                  </div>
              </form>

              <kbn-typeahead-items></kbn-typeahead-items>
            </div>
          </div>

          <md-button ng-click="startOver()" type="button" class="md-icon-button"
                     aria-label="New Visualization">
              <md-icon md-font-set="mdi" md-font-icon="mdi-file-outline" class="mdi-24px"></md-icon>

              <md-tooltip>
                  <span translate>New Visualization</span>
              </md-tooltip>
          </md-button>

          <md-button type="button" class="md-icon-button"
                     ng-class="{active: configTemplate.is('save')}"
                     ng-click="configTemplate.toggle('save')"
                     ng-if="!editableVis.dirty"
                     aria-expanded="{{ configTemplate.is('save') }}"
                     aria-label="Save Visualization">
              <md-icon md-font-set="mdi" md-font-icon="mdi-content-save" class="mdi-24px"></md-icon>

              <md-tooltip>
                  <span translate>Save Visualization</span>
              </md-tooltip>
          </md-button>

          <md-button type="button" class="md-icon-button"
                     disabled
                     ng-if="editableVis.dirty"
                     aria-label="Apply or Discard your changes before saving">
              <md-icon md-font-set="mdi" md-font-icon="mdi-content-save" class="mdi-24px"></md-icon>

              <md-tooltip>
                  <span translate>Apply or Discard your changes before saving</span>
              </md-tooltip>
          </md-button>

          <md-button type="button" class="md-icon-button"
                     ng-class="{active: configTemplate.is('load')}"
                     ng-click="configTemplate.toggle('load')"
                     aria-haspopup="true"
                     aria-expanded="{{ configTemplate.is('load') }}"
                     aria-label="Load Saved Visualization">
              <md-icon md-font-set="mdi" md-font-icon="mdi-folder-outline" class="mdi-24px"></md-icon>

              <md-tooltip>
                  <span translate>Load Saved Visualization</span>
              </md-tooltip>
          </md-button>

          <md-button type="button" class="md-icon-button"
                     ng-class="{active: configTemplate.is('share')}"
                     ng-click="configTemplate.toggle('share')"
                     aria-haspopup="true"
                     aria-expanded="{{ configTemplate.is('share') }}"
                     aria-label="Share Visualization">
              <md-icon md-font-set="mdi" md-font-icon="mdi-share" class="mdi-24px"></md-icon>

              <md-tooltip>
                  <span translate>Share Visualization</span>
              </md-tooltip>
          </md-button>

          <md-button type="button" class="md-icon-button"
                     ng-click="fetch()"
                     aria-label="Refresh">
              <md-icon md-font-set="mdi" md-font-icon="mdi-refresh" class="mdi-24px"></md-icon>

              <md-tooltip>
                  <span translate>Refresh</span>
              </md-tooltip>
          </md-button>
      </div>
  </md-toolbar>

  <config
    ng-if="chrome.getVisible()"
    config-template="configTemplate"
    config-object="conf">
  </config>

  <filter-bar state="state"></filter-bar>

  <div class="vis-editor-content">

    <div class="collapsible-sidebar" ng-if="chrome.getVisible()">
        <vis-editor-sidebar class="vis-editor-sidebar"></vis-editor-sidebar>
    </div>

    <div class="vis-editor-canvas" ng-class="{ embedded: !chrome.getVisible() }">
      <div class="visualize-info" ng-if="savedVis.id">
        <div class="visualize-info-tab" title="{{::savedVis.vis.type.title}}">
          <i class="mdi" aria-label="{{::savedVis.vis.type.title}} Icon" ng-class="savedVis.vis.type.icon"></i>
          <span ng-bind="::savedVis.title"></span>
        </div>
      </div>

      <visualize
        vis="vis"
        ui-state="uiState"
        show-spy-panel="chrome.getVisible()"
        editable-vis="editableVis"
        search-source="savedVis.searchSource">
      </visualize>
    </div>
  </div>

</div>
